# 格式审计组（第二组）三大任务详细划分及完成验证方式
格式审计组核心负责论文排版、格式、语义层面的标准化审计，包含**CV/布局开发（2人）、语义判定（1人）、数据测试/标注（1人）** 三大核心任务，各任务围绕「视觉布局解析-语义规则校验-样本测试验证」形成闭环，以下按**角色核心职责、人员分工（多人任务）、分阶段详细任务划分、多维度完成验证方式**展开，所有任务均遵循系统统一技术规范（Python3.10.x、FastAPI异步、Pydantic V2校验等），核心技术栈为PyMuPDF/OpenCV。

## 一、CV/布局开发（2人）
### 核心职责
基于PyMuPDF/OpenCV实现PDF布局结构化解析、图表/公式/标题等视觉元素的坐标提取与位置校验，检测图表标号关联、公式编号对齐、标题层级视觉特征等格式问题，为前端提供锚点定位坐标数据，是格式审计的**视觉层核心能力**。
### 人员分工
- **开发1岗**：侧重**PDF解析与基础视觉元素提取**，负责PyMuPDF封装、PDF页面/区域/元素的结构化解析，输出标准化视觉元素数据；
- **开发2岗**：侧重**CV视觉校验与前端对接**，负责OpenCV视觉分析模块开发、格式规则视觉校验、与前端锚点定位的交互开发，完成与语义判定模块的融合。
### 分阶段详细任务划分
#### 阶段1：环境搭建与工具封装（2人协同，3个核心子任务）
1. 按系统规范搭建Python3.10.x开发环境，安装PyMuPDF/OpenCV核心库+FastAPI/Pydantic V2/httpx通用库，编写基础`requirements.txt`和Dockerfile框架；
2. 封装PyMuPDF通用工具类：实现PDF页面读取、页码/尺寸/边距等基础信息提取、PDF元素（文本/图片/公式/表格）的通用识别函数；
3. 封装OpenCV基础视觉工具类：实现图像灰度化、轮廓检测、坐标匹配、视觉特征（字体/字号/缩进）的初步提取函数，制定视觉元素的**标准化数据格式**（含元素类型、坐标、文本内容、所属区域）。
#### 阶段2：PDF布局结构化解析模块开发（开发1岗主导，开发2岗配合）
1. 开发**PDF区域划分逻辑**：基于页面坐标和视觉特征，将PDF自动划分为正文区、图表区、公式区、标题区、参考文献区、引用标注区6大核心区域；
2. 开发**视觉元素精细化提取**：针对各区域提取专属元素特征，包括图表的标号/标题/位置、公式的编号/位置、标题的层级视觉特征（字体/字号/缩进/行距）、引用标注的位置/文本（如[1]）；
3. 开发**元素结构化存储**：将提取的所有视觉元素转化为**Pydantic V2标准化模型**，包含`paper_id/chunk_id/元素类型/坐标信息/文本内容/所属区域`，支持写入系统数据库临时表，为后续校验提供数据；
4. 开发**异常PDF兼容处理**：针对扫描版PDF、加密PDF、多列排版PDF做兼容解析，避免解析失败，记录解析异常日志。
#### 阶段3：CV视觉格式校验模块开发（开发2岗主导，开发1岗配合）
1. **图表格式校验**：开发图表标号与标题的关联校验、标题位置校验（图标题在下方/表标题在上方）、正文“见图X/表X”与实际图表标号的匹配校验，标记`Label_Missing`问题；
2. **公式格式校验**：开发公式编号提取与右对齐校验、公式编号与正文引用的匹配校验，标记公式未编号/编号错位问题；
3. **标题层级校验**：基于视觉特征（字体/字号/缩进）开发标题层级识别逻辑，检测标题序号跳级（如2.1→2.1.2），标记`Hierarchy_Fault`问题；
4. **引用标注视觉校验**：提取正文中引用标注的位置与文本，与参考文献区的引用条目做初步视觉关联，为后续语义判定的引用一致性做数据铺垫；
5. **视觉校验结果标准化**：将所有视觉格式问题转化为系统统一的**审计结果中间数据**，包含问题类型、位置坐标、证据文本、风险等级（Info/Warning/Critical）。
#### 阶段4：锚点定位与前端/中枢组对接开发（2人协同）
1. 开发**锚点坐标生成逻辑**：为每个检测到的格式问题生成**精准坐标锚点**（含页码、段落/元素坐标、高亮范围），满足前端“点击评语跳转到原文错误位置”的需求；
2. 开发**FastAPI异步接口适配**：将CV/布局模块的校验结果，按系统API协议封装为异步输出，与中枢组的Orchestrator对接，支持接收论文切片、返回视觉审计结果；
3. 开发**与前端的交互接口**：按前端React+Tailwind CSS的要求，提供Markdown渲染所需的**元素高亮、坐标跳转**数据接口，支持左右分屏的视觉联动。
#### 阶段5：模块联调与性能优化（2人协同）
1. 与语义判定模块联调：接收语义判定模块的术语/标点/错别字校验规则，将视觉元素数据与语义规则融合，形成**完整的格式审计结果**；
2. 性能优化：优化PDF解析和CV视觉分析的算法，降低单篇论文的处理耗时（latency_ms），控制Token消耗，满足系统批量审计（1000+篇）的性能要求；
3. 规则迭代：根据数据测试/标注模块的样本测试结果，修复漏检/误检问题，补充边缘场景的视觉校验规则（如多图表并列、跨页公式）。
#### 阶段6：交付前封装与文档编写（2人协同）
1. 按系统规范做**无状态封装**：所有核心逻辑不依赖本地存储，输入均来自中枢组，输出均对接中枢组/前端；
2. 完善Dockerfile：确保镜像可直接构建并运行，依赖版本精准；
3. 编写开发文档：包含模块架构、接口说明、视觉校验规则、坐标数据格式、异常处理方案。

### 完成验证方式
#### 1. 单元验证（各模块开发完成后，2人互测+自我验证）
- 验证PDF解析模块：输入10份不同类型PDF（正常排版/多列/扫描版），验证**元素提取准确率≥98%**，无区域划分错误、无元素漏提；
- 验证CV视觉校验模块：输入20份含视觉格式错误的样本，验证**视觉问题检测准确率≥95%、漏检率≤3%**，问题类型/位置标注精准；
- 验证锚点定位模块：输入含问题的PDF，验证前端点击评语后**原文跳转/高亮100%精准**，无坐标偏移。
#### 2. 集成验证（与语义判定模块融合后，数据测试/标注岗验证）
- 输入50份标注好的格式错误样本，验证视觉校验结果与语义校验结果融合后**无冲突、无重复**，审计结果符合系统JSON Schema规范。
#### 3. 接口验证（与中枢组/前端对接后，联合验证）
- 与中枢组接口：验证接收论文切片、返回审计结果的**异步交互100%正常**，无参数错误、无数据丢失，符合系统FastAPI协议；
- 与前端接口：验证锚点坐标、高亮数据的**传输与渲染100%正常**，支持批量论文的视觉联动。
#### 4. 性能验证（批量测试，管理员看板监控）
- 输入100篇论文做批量审计，验证**单篇平均耗时≤3s**，无内存泄漏，Token消耗符合系统要求，支持并发请求（≥20并发）。
#### 5. 交付验证（按系统交付标准，核心管理层验收）
- 交付物完整：源码+requirements.txt+Dockerfile+开发文档，符合系统规范；
- 无状态设计验证：重启服务/更换部署环境后，功能100%正常，无本地存储依赖。

## 二、语义判定（1人）
### 核心职责
编写错别字红线判定逻辑（通过上下文判定红线标准），开发术语一致性、标点符号中英文混用、引用格式语义一致性等**语义层格式校验**，将语义规则与CV/布局模块的视觉元素数据融合，输出完整的格式审计语义结果，是格式审计的**规则层核心能力**。
### 人员分工
单人全流程负责，无再拆分，按**规则建模-模块开发-融合联调-迭代优化**推进。
### 分阶段详细任务划分
#### 阶段1：格式语义规则拆解与建模（核心规则梳理）
1. 拆解系统要求的格式语义审计规则，形成**可量化、可代码化的规则库**，包含4大类核心规则：
    - 错别字红线规则：全文错别字＞10个/单页错别字＞2个，判定为Warning；关键术语错别字（如专业名词）直接判定为Critical；
    - 术语一致性规则：同一专有名词的写法需统一（如“深度学习”不可与“deep-learning”“深度学习”混用），支持自定义术语库；
    - 标点符号规则：杜绝中英文标点混用（如英文逗号“,”与中文逗号“，”）、标点位置错误（如引用标注在标点外）；
    - 引用格式语义规则：正文中引用标注的风格需统一（如IEEE格式[1]不可与APA格式(Wang,2023)混用）、引用标注与参考文献条目语义匹配。
2. 基于Pydantic V2构建**语义规则模型**，定义规则的触发条件、风险等级、问题描述模板，支持规则的动态调整（适配管理员看板的参数优化）。
#### 阶段2：错别字红线判定模块开发
1. 集成轻量级中文分词/错别字检测工具（如结巴分词+百度纠错API/自研简单纠错逻辑），实现论文文本的错别字识别；
2. 开发**上下文语义纠错逻辑**：结合论文专业领域（软件工程）做歧义排除，避免将专业名词误判为错别字（如“张量”不可判为错字）；
3. 开发**错别字统计与红线触发逻辑**：按页码/全文统计错别字数量，触发对应的风险等级，生成标准化的问题评语（如“全文错别字共12个，超出红线标准，建议逐一修正”）；
4. 开发**错别字定位逻辑**：将识别出的错别字与CV/布局模块的视觉坐标关联，实现“错别字位置精准高亮”。
#### 阶段3：术语/标点/引用格式语义校验模块开发
1. **术语一致性模块**：提取论文中的专有名词，建立临时术语库，遍历文本检测术语写法不一致问题，标记问题位置并生成统一建议（如“全文‘深度学习’与‘deep-learning’混用，建议统一为‘深度学习’”）；
2. **标点符号模块**：对接CV/布局模块提取的标点符号视觉数据，检测中英文标点混用、标点位置错误，生成问题评语；
3. **引用格式模块**：提取CV/布局模块的引用标注文本，检测引用风格一致性，结合数据测试/标注模块的参考文献样本，检测引用标注与参考文献条目的语义匹配性（如[1]对应参考文献的作者/年份是否一致）。
#### 阶段4：与CV/布局模块的融合开发
1. 开发**数据交互接口**：与CV/布局模块实现异步数据互通，接收其提取的视觉元素文本/坐标数据，输出语义校验结果；
2. 开发**格式审计结果融合逻辑**：将视觉层问题（如图表标号缺失）与语义层问题（如错别字超标）整合，形成**统一的格式审计结果JSON**，符合系统API返回协议；
3. 开发**结果去重逻辑**：避免视觉层和语义层对同一问题的重复标注（如引用标注位置错误，不重复标记为视觉问题和语义问题）。
#### 阶段5：规则迭代与动态调整开发
1. 开发**规则配置接口**：支持通过管理员看板Web界面调整语义规则（如修改错别字红线数量、新增专业术语、调整风险等级），无需修改代码；
2. 基于测试样本的反馈，优化语义校验逻辑，降低误检率（如优化专业领域歧义排除、完善术语库）。
#### 阶段6：模块测试与文档编写
1. 针对各模块做单元测试，修复逻辑漏洞；
2. 编写**语义规则开发文档**，包含规则详情、模块架构、接口说明、管理员看板配置方法。

### 完成验证方式
#### 1. 规则建模验证（核心管理层+数据测试/标注岗验证）
- 规则库完整：覆盖错别字、术语、标点、引用格式4大类，符合软件工程硕士论文的格式规范；
- 规则可量化：触发条件、风险等级定义清晰，无模糊表述，支持代码化实现。
#### 2. 单元验证（自我测试+数据测试/标注岗样本测试）
- 错别字检测：输入50份含错别字的论文样本（含专业领域文本），验证**准确率≥98%、误检率≤2%**，红线触发逻辑100%正确；
- 术语/标点/引用校验：输入30份含对应问题的样本，验证**检测准确率≥95%**，问题定位精准，统一建议合理。
#### 3. 融合验证（与CV/布局模块联调，3人协同验证）
- 数据交互：与CV/布局模块的异步数据互通100%正常，无数据丢失、无格式错误；
- 结果融合：视觉层+语义层结果整合无冲突、无重复，输出的审计结果JSON**100%符合系统API返回协议**。
#### 4. 动态调整验证（管理员看板模拟验证）
- 规则配置接口正常：可通过Web界面修改错别字红线、新增术语，修改后规则**实时生效**，校验结果同步更新。
#### 5. 场景化验证（真实论文测试）
- 输入10篇真实软件工程硕士论文，覆盖正常排版/多种格式问题，验证**格式审计结果完整、精准**，无漏检/误检核心问题，评语符合导师评审习惯。

## 三、数据测试/标注（1人）
### 核心职责
作为格式审计组的**支撑岗**，负责排版错误样本库搭建、标注规范制定、批量样本标注与核查、测试用例设计与维护，为CV/布局开发、语义判定提供**测试样本和验证依据**，同时负责开发过程中的回归测试、格式审计结果的一致性核查，保障开发质量。
### 人员分工
单人全流程负责，按**样本库搭建-标注执行-测试用例设计-回归测试-结果核查**推进，是开发与验证的**桥梁**。
### 分阶段详细任务划分
#### 阶段1：排版错误样本库搭建与标注规范制定
1. **样本收集**：收集软件工程硕士论文PDF样本≥200份，包含**规范样本（50份）、含单一格式问题样本（100份）、含混合格式问题样本（50份）**，覆盖图表/公式/标题/错别字/术语/标点/引用等所有格式审计维度；
2. **样本分类**：按格式问题类型（如图表问题、错别字问题、引用问题）对样本进行分类，为CV/布局、语义判定模块提供针对性测试样本；
3. **标注规范制定**：制定**格式问题标注手册**，明确问题类型、标注位置、风险等级、证据提取要求，确保标注结果的标准化、一致性，手册需经核心管理层审核通过。
#### 阶段2：批量样本标注与核查
1. 按标注手册对收集的样本进行**精细化标注**，包含问题类型、页码/段落/元素位置、证据文本、风险等级、修正建议，标注结果存储为Excel+JSON双格式；
2. 开发**标注结果自查工具**：实现标注结果的重复标注、标注错误的自动检测，降低标注误差；
3. 对标注结果进行**全量核查**，对模糊标注、错误标注进行修正，确保标注准确率100%，形成**标准化格式错误样本库**，提供给CV/布局、语义判定模块开发测试。
#### 阶段3：测试用例设计与维护
1. 基于标注好的样本库，为CV/布局、语义判定模块分别设计**单元测试用例、集成测试用例、场景化测试用例**，覆盖正常场景/异常场景/边缘场景；
2. 为每个测试用例定义**预期结果、通过标准**（如量化的准确率/漏检率指标），编写测试用例文档；
3. 建立测试用例维护机制，随开发模块的迭代优化，及时补充/更新测试用例（如新增异常PDF兼容逻辑后，补充对应测试用例）。
#### 阶段4：开发过程中的回归测试与问题反馈
1. **单元测试**：在CV/布局、语义判定各模块开发完成后，执行对应测试用例，记录测试结果，统计**准确率/漏检率/误检率**，向开发岗反馈问题及复现步骤；
2. **回归测试**：在开发岗修复问题后，重新执行测试用例，验证问题是否解决，确保修复后不引入新的BUG；
3. **批量测试**：在CV/布局、语义判定模块融合后，执行批量样本测试，统计整体格式审计的指标，形成测试报告。
#### 阶段5：格式审计结果一致性核查
1. 对接中枢组的Orchestrator，对格式审计组的最终输出结果进行**全量核查**，确保结果JSON符合系统API协议、数据库写入字段完整、与其他Agent组的结果格式一致；
2. 核查锚点定位的精准性，确保前端“点击评语跳转到原文”的功能100%正常；
3. 对导师复核流程进行**模拟测试**，确保AI生成的评语可编辑、可忽略，一键导出功能正常。
#### 阶段6：交付样本库与测试文档
1. 整理标准化格式错误样本库、标注手册、测试用例文档、测试报告；
2. 按系统规范将样本库转化为**可直接调用的测试数据集**，提供给组内后续迭代优化及系统整体联调使用。

### 完成验证方式
#### 1. 样本库验证（核心管理层+组内开发岗验证）
- 样本量达标：≥200份，覆盖所有格式审计维度，包含规范/单一问题/混合问题样本；
- 样本标注准确：标注结果100%符合标注手册，无错误标注/模糊标注，Excel+JSON格式标准化。
#### 2. 测试用例验证（核心管理层验证）
- 测试用例完整：覆盖单元/集成/场景化/边缘场景，每个模块测试用例≥50个；
- 用例定义清晰：包含输入样本、预期结果、通过标准，可直接执行测试，无模糊表述。
#### 3. 测试执行验证（组内开发岗+核心管理层验证）
- 测试报告完整：包含测试结果、指标统计（准确率/漏检率）、问题列表、复现步骤，无遗漏；
- 问题反馈及时：开发过程中的BUG均及时反馈并记录，修复后回归测试100%通过。
#### 4. 结果核查验证（与中枢组/前端联调，联合验证）
- 格式审计结果：输出的JSON100%符合系统API协议，数据库写入字段完整，无格式错误；
- 锚点定位/导师复核：前端交互功能、导师复核流程100%正常，无功能异常。
#### 5. 交付验证（核心管理层验收）
- 交付物完整：样本库+标注手册+测试用例文档+测试报告，所有交付物均按系统规范整理，可直接复用。

## 二、格式审计组整体联调验证（三大任务融合后）
除各任务单独验证外，需完成**组内整体联调验证**和**系统级集成验证**，作为最终验收依据：
1. **组内整体验证**：输入50份混合格式问题的论文样本，格式审计组整体输出的审计结果**无漏检核心问题、无重复标注、无误检**，整体准确率≥95%，锚点定位100%精准；
2. **系统级集成验证**：与中枢组Orchestrator实现异步交互，接收论文切片、返回审计结果，结果可被反思评估组正常读取并参与冲突仲裁，无数据格式冲突；
3. **性能与兼容验证**：支持1000+篇论文的批量审计，单篇平均耗时≤3s，兼容不同排版/版本的PDF，无解析/审计失败。